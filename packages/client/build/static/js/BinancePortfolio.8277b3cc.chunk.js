(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[2],{380:function(e,t,r){"use strict";r.r(t),r.d(t,"BinancePortfolio",(function(){return M}));var a=r(16),c=r(0),n=r(423),s=r(461),i=r(371),o=r(31),l=r(142),j=r(34),b=r(74),u=r(36),d=r(47),O=r(40),h=r(59),p=r.n(h),f=r(56),x=r(44),m=r(465),g={},v={},P=new m.a(g),S=new m.a(v),U=-1,y=-1,C=function(e,t){g[e]=t,clearTimeout(U),U=setTimeout((function(){P.next(g)}),200)},N=function(e,t){v[e]=t,clearTimeout(y),y=setTimeout((function(){S.next(v)}),200)},k=r(24),D=r(39),w=r.n(D),B=r(79),_=r(186),z=function(){var e=Object(B.a)(w.a.mark((function e(t){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){_.a.query({query:j.n,fetchPolicy:"network-only",variables:{symbol:t}}).then((function(t){return e({error:"",data:t.data.getBinanceTrades})}),(function(t){return e({error:t,data:[]})}))})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T=function(){var e=Object(B.a)(w.a.mark((function e(){return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){_.a.query({query:j.l}).then((function(t){return e({error:"",data:t.data.getBinanceExchangeInformation})}),(function(t){return e({error:t,data:[]})}))})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),E=r(432),G=r.n(E),$=r(1),A=function(e){var t,r,n,s,l=e.balance,h=e.showAll,m=e.index,g=void 0===(s=l.free+l.locked)||null===s?Number.NaN:parseFloat(s),v=Object(o.useSubscription)(j.c,{variables:{symbol:"".concat(l.asset,"BUSD")}}),P=function(e){var t=e.asset,r=Object(c.useState)({loading:!1,error:void 0,data:[]}),n=Object(a.a)(r,2),s=n[0],i=n[1];return[function(){var e=Object(B.a)(w.a.mark((function e(){var r,a,c,n;return w.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i({data:[],error:void 0,loading:!0}),e.next=3,T();case 3:if(!(r=e.sent).error){e.next=9;break}console.log(r),i({data:[],loading:!1,error:r.error}),e.next=17;break;case 9:return a=[],["BUSD","USDT"].forEach((function(e){var c="".concat(t).concat(e).toUpperCase();r.data.find((function(e){return e.symbol===c}))&&a.push(z(c))})),e.next=14,Promise.all(a);case 14:(c=e.sent).find((function(e){return!!e.error}))?(console.log(c),i({data:[],loading:!1,error:c[0].error})):(n=[],c.forEach((function(e){n=n.concat(e.data)})),n.sort((function(e,t){return e.time-t.time})),i({data:n,loading:!1,error:void 0}));case 17:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Object(x.a)({},s)]}({asset:l.asset}),S=Object(a.a)(P,2),U=S[0],y=S[1];Object(c.useEffect)((function(){N(l.asset,["USDT","BUSD"].includes(l.asset.toUpperCase())?g:0),C(l.asset,["USDT","BUSD"].includes(l.asset.toUpperCase())?g:0),["USDT","BUSD"].includes(l.asset.toUpperCase())||setTimeout(U,100*m)}),[]);var D=Object(c.useCallback)((function(){u.b.modal.open({name:k.f.BinanceSellOrder,props:{symbol:"".concat(l.asset,"BUSD"),amount:l.free}})}),[u.b]),_=Object(c.useMemo)((function(){var e,t,r;return["USDT","BUSD"].includes(l.asset.toUpperCase())?1:(null===(e=v.data)||void 0===e?void 0:e.binanceLastPrice)?(C(l.asset,g*(null===(t=v.data)||void 0===t?void 0:t.binanceLastPrice.ask)),null===(r=v.data)||void 0===r?void 0:r.binanceLastPrice.ask):Number.NaN}),[v,C,g]),E=Object(c.useMemo)((function(){return["USDT","BUSD"].includes(l.asset.toUpperCase())?g:_>0?_*g:Number.NaN}),[_,g]),A=Object(c.useMemo)((function(){var e=y.data,t={amount:0,pricePerShare:0,realizedProfit:0,price:0};if(["USDT","BUSD"].includes(l.asset.toUpperCase())&&(t.amount=g,t.pricePerShare=1,t.price=g),Array.isArray(e)){var r=Object(O.a)(e);r.sort((function(e,t){return e.time-t.time})),r.forEach((function(e){var r=e.price,a=e.qty,c=e.isBuyer,n=e.commission,s=e.commissionAsset;e.time;c?(["BUSD","USDT"].includes(s.toUpperCase())?(t.realizedProfit-=n,t.amount+=a,t.price+=r*a):s.toUpperCase()===l.asset.toUpperCase()?(t.amount+=a-n,t.price+=r*(a-n)):(t.amount+=a,t.price+=r*a),t.pricePerShare=t.price/t.amount):(["BUSD","USDT"].includes(s.toUpperCase())?(t.realizedProfit-=n,t.amount-=a,t.realizedProfit+=r*a-t.pricePerShare*a):s.toUpperCase()===l.asset.toUpperCase()?(t.amount-=a+n,t.realizedProfit+=r*(a-n)-t.pricePerShare*(a-n)):(t.amount-=a,t.realizedProfit+=r*a-t.pricePerShare*a),t.price=t.pricePerShare*t.amount)})),t.price=t.pricePerShare*g,N(l.asset,t.price)}return t}),[y.data]),q=Object(c.useMemo)((function(){return!["USDT","BUSD"].includes(l.asset.toUpperCase())&&A.price>0?[E-A.price,100/A.price*E-100]:[0,0]}),[g,E,A.price]),F=Object(a.a)(q,2),M=F[0],I=F[1];return g<1e-4||A.price<1&&!h?Object($.jsx)($.Fragment,{}):Object($.jsx)($.Fragment,{children:Object($.jsxs)("tr",{children:[Object($.jsx)("td",{children:Object($.jsx)("b",{children:Object($.jsx)("a",{href:"https://www.tradingview.com/chart/?symbol=BINANCE:".concat(l.asset,"BUSD"),target:"_blank",rel:"noreferrer",children:l.asset})})}),Object($.jsx)("td",{children:Object(f.b)(g,4)}),Object($.jsxs)("td",{children:[Object(f.b)(A.pricePerShare,4)," $"]}),Object($.jsxs)("td",{children:[Object(f.b)(_,4)," $"]}),Object($.jsxs)("td",{children:[Object(f.b)(A.price)," $"]}),Object($.jsxs)("td",{children:[Object(f.b)(E)," $"]}),Object($.jsx)("td",{className:G.a.equalCell,children:"="}),Object($.jsxs)("td",{className:p()((t={},Object(d.a)(t,G.a.green,M>=0),Object(d.a)(t,G.a.red,M<0),t)),children:[Object(f.b)(M)," $"]}),Object($.jsxs)("td",{className:p()((r={},Object(d.a)(r,G.a.green,M>=0),Object(d.a)(r,G.a.red,M<0),r)),children:[Object(f.b)(I),"%"]}),Object($.jsxs)("td",{className:p()((n={},Object(d.a)(n,G.a.green,A.realizedProfit>=0),Object(d.a)(n,G.a.red,A.realizedProfit<0),n)),children:[Object(f.b)(A.realizedProfit)," $"]}),Object($.jsx)("td",{children:!["USDT","BUSD"].includes(l.asset.toUpperCase())&&Object($.jsx)(i.a,{onClick:D,children:Object($.jsx)(b.c,{})})})]},l.asset)})},q=function(e,t){return void 0===e||null===e?e:parseFloat(e.toString()).toFixed(t||2)},F=function(){var e,t,r,n,s=function(){var e=6833,t=Object(c.useState)({actualPrice:0,boughtPrice:0,gain:0,percentageGain:0,overallGain:0,overallPercentageGain:0}),r=Object(a.a)(t,2),n=r[0],s=r[1],i=Object(c.useCallback)((function(){var t={actualPrice:0,boughtPrice:0,gain:0,percentageGain:0,overallGain:0,overallPercentageGain:0};Object.entries(g).forEach((function(e){var r=Object(a.a)(e,2),c=(r[0],r[1]);t.actualPrice+=c})),Object.entries(v).forEach((function(e){var r=Object(a.a)(e,2),c=(r[0],r[1]);t.boughtPrice+=c})),t.gain=t.actualPrice-t.boughtPrice,t.percentageGain=100/t.boughtPrice*t.actualPrice-100,t.overallGain=t.actualPrice-e,t.overallPercentageGain=100/e*t.actualPrice-100,s(t)}),[s]);return Object(c.useEffect)((function(){var e=P.subscribe((function(e){i()})),t=S.subscribe((function(e){i()}));return function(){e.unsubscribe(),t.unsubscribe()}}),[i]),Object(x.a)({deposit:e},n)}(),i=s.deposit,o=s.boughtPrice,l=s.actualPrice,j=s.gain,b=s.overallGain,u=s.overallPercentageGain,O=s.percentageGain;return Object($.jsxs)($.Fragment,{children:[Object($.jsxs)("tr",{children:[Object($.jsx)("td",{}),Object($.jsx)("td",{}),Object($.jsx)("td",{}),Object($.jsx)("td",{}),Object($.jsx)("td",{children:Object($.jsxs)("b",{children:[q(o)," $"]})}),Object($.jsx)("td",{children:Object($.jsxs)("b",{children:[q(l)," $"]})}),Object($.jsx)("td",{children:"="}),Object($.jsx)("td",{className:p()((e={},Object(d.a)(e,G.a.green,j>=0),Object(d.a)(e,G.a.red,j<0),e)),children:Object($.jsxs)("b",{children:[q(j)," $"]})}),Object($.jsx)("td",{className:p()((t={},Object(d.a)(t,G.a.green,O>=0),Object(d.a)(t,G.a.red,O<0),t)),children:Object($.jsxs)("b",{children:[q(O),"%"]})}),Object($.jsx)("td",{}),Object($.jsx)("td",{})]}),Object($.jsxs)("tr",{children:[Object($.jsx)("td",{}),Object($.jsx)("td",{}),Object($.jsx)("td",{}),Object($.jsx)("td",{}),Object($.jsx)("td",{children:Object($.jsxs)("b",{children:[i," $"]})}),Object($.jsx)("td",{children:Object($.jsxs)("b",{children:[q(l)," $"]})}),Object($.jsx)("td",{children:"="}),Object($.jsx)("td",{className:p()((r={},Object(d.a)(r,G.a.green,b>=0),Object(d.a)(r,G.a.red,b<0),r)),children:Object($.jsxs)("b",{children:[q(b)," $"]})}),Object($.jsx)("td",{className:p()((n={},Object(d.a)(n,G.a.green,b>=0),Object(d.a)(n,G.a.red,b<0),n)),children:Object($.jsxs)("b",{children:[q(u),"%"]})}),Object($.jsx)("td",{}),Object($.jsx)("td",{})]})]})},M=function(){var e,t,r="BINANCE",d=Object(c.useState)(!1),O=Object(a.a)(d,2),h=O[0],p=O[1],f=Object(o.useQuery)(j.k,{fetchPolicy:"network-only",notifyOnNetworkStatusChange:!0}),x=Object(o.useSubscription)(j.b);Object(c.useEffect)((function(){f.loading?u.b.modalLoader.show(r):u.b.modalLoader.close(r)}),[f.loading]);var m=Object(c.useCallback)((function(){f.refetch()}),[f]);Object(c.useEffect)((function(){m(),console.log(x.data)}),[x.data]);var g=Object(c.useMemo)((function(){var e,t,r=null===(e=f.data)||void 0===e||null===(t=e.getBinanceAccountInformation)||void 0===t?void 0:t.balances;return Array.isArray(r)?r.filter((function(e){return e.locked+e.free>0})).sort((function(e,t){return e.asset.localeCompare(t.asset)})):[]}),[null===(e=f.data)||void 0===e||null===(t=e.getBinanceAccountInformation)||void 0===t?void 0:t.balances]);return Object($.jsxs)($.Fragment,{children:[Object($.jsx)(n.a,{paddingLeft:4,paddingRight:4,bgcolor:l.a[600],className:G.a.header,children:Object($.jsxs)(n.a,{className:G.a.content,children:[Object($.jsx)(s.a,{checked:h,color:"primary",onChange:function(){return p(!h)}}),f.loading&&Object($.jsx)("span",{children:"Pending"}),Object($.jsx)(i.a,{onClick:m,children:Object($.jsx)(b.j,{})})]})}),Object($.jsx)(n.a,{className:G.a.tableWrapper,pr:3,pl:3,pt:3,pb:3,children:Object($.jsx)("table",{children:Object($.jsxs)("tbody",{children:[Object($.jsxs)("tr",{children:[Object($.jsx)("th",{children:"Symbol"}),Object($.jsx)("th",{children:"Mno\u017estv\xed"}),Object($.jsx)("th",{colSpan:2,children:"Cena za akcii"}),Object($.jsx)("th",{colSpan:2,children:"Hodnota"}),Object($.jsx)("th",{className:G.a.equalCell,children:"\xa0"}),Object($.jsx)("th",{colSpan:2,children:"Nerealizovan\xfd zisk/ztr\xe1ta"}),Object($.jsx)("th",{children:"Realizovan\xfd zisk/ztr\xe1ta"}),Object($.jsx)("th",{children:"\xa0"})]}),Object($.jsx)($.Fragment,{children:g.map((function(e,t){return Object($.jsx)(A,{balance:e,showAll:h,index:t},"row_".concat(e.asset))}))}),Object($.jsx)(F,{})]})})})]})}},432:function(e,t,r){e.exports={header:"styles_header__1hMg4",tableWrapper:"styles_tableWrapper__3O0Ie",equalCell:"styles_equalCell__1Jx_P",green:"styles_green__2Xuuz",red:"styles_red__1J-Jx"}}}]);
//# sourceMappingURL=BinancePortfolio.8277b3cc.chunk.js.map